<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Analyzer Calculator</title>
    <style>
        body {
            font-family: 'Calibri', 'Arial', sans-serif;
            background: #ffffff;
            color: #000000;
            margin: 20px;
            padding: 0;
            box-sizing: border-box;
        }
        .calculator {
            max-width: 900px;
            margin: 0 auto;
            border: 1px solid #000000;
        }
        h1 {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
            border-bottom: 1px solid #000000;
            padding-bottom: 5px;
        }
        .section {
            margin: 10px;
            border: 1px solid #000000;
        }
        h2 {
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            background: #d3d3d3;
            padding: 5px;
            border-bottom: 1px solid #000000;
        }
        .input-table, .result-table {
            width: 100%;
            border-collapse: collapse;
        }
        .input-table th, .input-table td, .result-table th, .result-table td {
            border: 1px solid #000000;
            padding: 5px;
            font-size: 14px;
            text-align: left;
        }
        .input-table th {
            background: #d3d3d3;
            font-weight: bold;
        }
        .result-table th {
            background: #d3d3d3;
            font-weight: bold;
        }
        input {
            width: 100%;
            border: none;
            padding: 5px;
            font-size: 14px;
            background: #f0f0f0;
            box-sizing: border-box;
        }
        input:focus {
            outline: none;
            background: #e0e0e0;
        }
        button {
            display: block;
            width: 100px;
            margin: 10px auto;
            padding: 8px;
            background: #d3d3d3;
            border: 1px solid #000000;
            font-size: 14px;
            cursor: pointer;
        }
        button:hover {
            background: #c0c0c0;
        }
        #results {
            margin: 10px;
        }

        /* Responsive Design */
        @media screen and (max-width: 768px) {
            .calculator {
                max-width: 100%;
                margin: 10px;
            }
            h1 {
                font-size: 16px;
            }
            h2 {
                font-size: 14px;
                padding: 4px;
            }
            .input-table th, .input-table td, .result-table th, .result-table td {
                font-size: 12px;
                padding: 4px;
            }
            input {
                font-size: 12px;
                padding: 4px;
            }
            button {
                width: 80px;
                font-size: 12px;
                padding: 6px;
            }
            .section {
                margin: 5px;
            }
        }

        @media screen and (max-width: 480px) {
            .input-table, .result-table {
                display: block;
            }
            .input-table tr, .result-table tr {
                display: flex;
                flex-direction: column;
                border-bottom: 1px solid #000000;
            }
            .input-table th, .input-table td, .result-table th, .result-table td {
                display: block;
                width: 100%;
                box-sizing: border-box;
                font-size: 11px;
                padding: 3px;
            }
            .input-table th {
                background: #d3d3d3;
            }
            .result-table th {
                background: #d3d3d3;
            }
            input {
                font-size: 11px;
                padding: 3px;
            }
            h1 {
                font-size: 14px;
            }
            h2 {
                font-size: 12px;
                padding: 3px;
            }
            button {
                width: 70px;
                font-size: 11px;
                padding: 5px;
            }
            .section {
                margin: 3px;
            }
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>Investment Analyzer Calculator</h1>

        <div class="section">
            <h2>Property and Loan Details</h2>
            <table class="input-table">
                <tr>
                    <th>Parameter</th>
                    <th>Value (AED or %)</th>
                </tr>
                <tr>
                    <td>Purchase Price</td>
                    <td><input type="number" id="purchasePrice" value="750000" step="any"></td>
                </tr>
                <tr>
                    <td>Property Size (sq ft)</td>
                    <td><input type="number" id="propertySize" value="423" step="any"></td>
                </tr>
                <tr>
                    <td>LTV (%)</td>
                    <td><input type="number" id="ltvPercentage" value="50" step="any"></td>
                </tr>
                <tr>
                    <td>Loan Tenure (years)</td>
                    <td><input type="number" id="loanTenure" value="25" step="1"></td>
                </tr>
                <tr>
                    <td>Interest Rate (%)</td>
                    <td><input type="number" id="interestRate" value="6.5" step="any"></td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>Rent Details</h2>
            <table class="input-table">
                <tr>
                    <th>Parameter</th>
                    <th>Value (AED)</th>
                </tr>
                <tr>
                    <td>Gross Annual Rent</td>
                    <td><input type="number" id="grossAnnualRent" value="70000" step="any"></td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>Upfront Costs Parameters</h2>
            <table class="input-table">
                <tr>
                    <th>Parameter</th>
                    <th>Value (AED or %)</th>
                </tr>
                <tr>
                    <td>DLD Fee Percentage (%)</td>
                    <td><input type="number" id="dldFeePercentage" value="4" step="any"></td>
                </tr>
                <tr>
                    <td>Mortgage Registration Percentage (%)</td>
                    <td><input type="number" id="mortgageRegistrationPercentage" value="0.25" step="any"></td>
                </tr>
                <tr>
                    <td>Mortgage Registration Fixed Fee</td>
                    <td><input type="number" id="mortgageRegistrationFixedFee" value="290" step="any"></td>
                </tr>
                <tr>
                    <td>Bank Processing Percentage (%)</td>
                    <td><input type="number" id="bankProcessingPercentage" value="0.5" step="any"></td>
                </tr>
                <tr>
                    <td>Title Deed Fee</td>
                    <td><input type="number" id="titleDeedFee" value="580" step="any"></td>
                </tr>
                <tr>
                    <td>Registration Trustee Fee</td>
                    <td><input type="number" id="registrationTrusteeFee" value="4200" step="any"></td>
                </tr>
                <tr>
                    <td>Property Valuation Fee</td>
                    <td><input type="number" id="propertyValuationFee" value="2625" step="any"></td>
                </tr>
                <tr>
                    <td>Agency Fee Percentage (%)</td>
                    <td><input type="number" id="agencyFeePercentage" value="2" step="any"></td>
                </tr>
                <tr>
                    <td>VAT Percentage (%)</td>
                    <td><input type="number" id="vatPercentage" value="5" step="any"></td>
                </tr>
                <tr>
                    <td>Property Inspection Cost</td>
                    <td><input type="number" id="propertyInspectionCost" value="1500" step="any"></td>
                </tr>
                <tr>
                    <td>Conveyance Fee</td>
                    <td><input type="number" id="conveyanceFee" value="6000" step="any"></td>
                </tr>
                <tr>
                    <td>Furnishing Cost</td>
                    <td><input type="number" id="furnishingCost" value="0" step="any"></td>
                </tr>
                <tr>
                    <td>Utility Deposit Amount</td>
                    <td><input type="number" id="utilityDepositAmount" value="2000" step="any"></td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>Monthly Recurring Expenses</h2>
            <table class="input-table">
                <tr>
                    <th>Parameter</th>
                    <th>Value (AED)</th>
                </tr>
                <tr>
                    <td>Service Charge per sq ft per year</td>
                    <td><input type="number" id="serviceChargePerSqftPerYear" value="13.5" step="any"></td>
                </tr>
                <tr>
                    <td>Annual Home Insurance</td>
                    <td><input type="number" id="homeInsuranceAnnual" value="1000" step="any"></td>
                </tr>
                <tr>
                    <td>Monthly Utilities</td>
                    <td><input type="number" id="utilitiesMonthly" value="0" step="any"></td>
                </tr>
                <tr>
                    <td>Monthly Cleaning</td>
                    <td><input type="number" id="cleaningMonthly" value="0" step="any"></td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>Expense Percentages</h2>
            <table class="input-table">
                <tr>
                    <th>Parameter</th>
                    <th>Value (%)</th>
                </tr>
                <tr>
                    <td>Capex</td>
                    <td><input type="number" id="capexPercentage" value="10" step="any"></td>
                </tr>
                <tr>
                    <td>Repairs and Maintenance</td>
                    <td><input type="number" id="repairsPercentage" value="5" step="any"></td>
                </tr>
                <tr>
                    <td>Property Management</td>
                    <td><input type="number" id="propertyManagementPercentage" value="10" step="any"></td>
                </tr>
                <tr>
                    <td>Vacancy</td>
                    <td><input type="number" id="vacancyPercentage" value="5" step="any"></td>
                </tr>
                <tr>
                    <td>Refinance Cost</td>
                    <td><input type="number" id="refinanceCostPercentage" value="7" step="any"></td>
                </tr>
                <tr>
                    <td>Cash Reserves</td>
                    <td><input type="number" id="cashReservesPercentage" value="2.5" step="any"></td>
                </tr>
            </table>
        </div>

        <button onclick="calculate()">Calculate</button>

        <div id="results"></div>
    </div>

    <script>
        function calculate() {
            // Retrieve inputs
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const propertySize = parseFloat(document.getElementById('propertySize').value) || 0;
            const ltvPercentage = parseFloat(document.getElementById('ltvPercentage').value) || 0;
            const loanTenure = parseFloat(document.getElementById('loanTenure').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const grossAnnualRent = parseFloat(document.getElementById('grossAnnualRent').value) || 0;
            const dldFeePercentage = parseFloat(document.getElementById('dldFeePercentage').value) || 0;
            const mortgageRegistrationPercentage = parseFloat(document.getElementById('mortgageRegistrationPercentage').value) || 0;
            const mortgageRegistrationFixedFee = parseFloat(document.getElementById('mortgageRegistrationFixedFee').value) || 0;
            const bankProcessingPercentage = parseFloat(document.getElementById('bankProcessingPercentage').value) || 0;
            const titleDeedFee = parseFloat(document.getElementById('titleDeedFee').value) || 0;
            const registrationTrusteeFee = parseFloat(document.getElementById('registrationTrusteeFee').value) || 0;
            const propertyValuationFee = parseFloat(document.getElementById('propertyValuationFee').value) || 0;
            const agencyFeePercentage = parseFloat(document.getElementById('agencyFeePercentage').value) || 0;
            const vatPercentage = parseFloat(document.getElementById('vatPercentage').value) || 0;
            const propertyInspectionCost = parseFloat(document.getElementById('propertyInspectionCost').value) || 0;
            const conveyanceFee = parseFloat(document.getElementById('conveyanceFee').value) || 0;
            const furnishingCost = parseFloat(document.getElementById('furnishingCost').value) || 0;
            const utilityDepositAmount = parseFloat(document.getElementById('utilityDepositAmount').value) || 0;
            const serviceChargePerSqftPerYear = parseFloat(document.getElementById('serviceChargePerSqftPerYear').value) || 0;
            const homeInsuranceAnnual = parseFloat(document.getElementById('homeInsuranceAnnual').value) || 0;
            const utilitiesMonthly = parseFloat(document.getElementById('utilitiesMonthly').value) || 0;
            const cleaningMonthly = parseFloat(document.getElementById('cleaningMonthly').value) || 0;
            const capexPercentage = parseFloat(document.getElementById('capexPercentage').value) || 0;
            const repairsPercentage = parseFloat(document.getElementById('repairsPercentage').value) || 0;
            const propertyManagementPercentage = parseFloat(document.getElementById('propertyManagementPercentage').value) || 0;
            const vacancyPercentage = parseFloat(document.getElementById('vacancyPercentage').value) || 0;
            const refinanceCostPercentage = parseFloat(document.getElementById('refinanceCostPercentage').value) || 0;
            const cashReservesPercentage = parseFloat(document.getElementById('cashReservesPercentage').value) || 0;

            // 1. Loan & Initial Investment
            const loanAmount = purchasePrice * (ltvPercentage / 100);
            const downPayment = purchasePrice - loanAmount;
            const monthlyRate = (interestRate / 100) / 12;
            const termInMonths = loanTenure * 12;
            const emi = loanAmount * monthlyRate * Math.pow(1 + monthlyRate, termInMonths) / (Math.pow(1 + monthlyRate, termInMonths) - 1) || 0;
            const grossMonthlyRent = grossAnnualRent / 12;

            // 2. Upfront Costs
            const dldFeeAmount = purchasePrice * (dldFeePercentage / 100);
            const mortgageRegistrationAmount = (loanAmount * (mortgageRegistrationPercentage / 100)) + mortgageRegistrationFixedFee;
            const bankProcessingAmount = loanAmount * (bankProcessingPercentage / 100);
            const agencyFeeAmount = (purchasePrice * (agencyFeePercentage / 100)) * (1 + vatPercentage / 100);
            const totalNonRefundableUpfrontCosts = dldFeeAmount + mortgageRegistrationAmount + bankProcessingAmount + agencyFeeAmount + 
                                                   titleDeedFee + registrationTrusteeFee + propertyValuationFee + 
                                                   propertyInspectionCost + conveyanceFee + furnishingCost;
            const totalInitialCashInvestment = downPayment + totalNonRefundableUpfrontCosts + utilityDepositAmount;
            const acquisitionCost = purchasePrice + totalNonRefundableUpfrontCosts;

            // 3. Monthly Recurring Expenses
            const monthlyServiceCharge = (propertySize * serviceChargePerSqftPerYear) / 12;
            const monthlyHomeInsurance = homeInsuranceAnnual / 12;
            const monthlyCapexReserve = grossMonthlyRent * (capexPercentage / 100);
            const monthlyRepairsMaintenance = grossMonthlyRent * (repairsPercentage / 100);
            const monthlyPropertyManagementFee = grossMonthlyRent * (propertyManagementPercentage / 100);
            const monthlyVacancyLoss = grossMonthlyRent * (vacancyPercentage / 100);
            const monthlyRefinanceCostAllocation = grossMonthlyRent * (refinanceCostPercentage / 100);
            const monthlyCashReservesAllocation = grossMonthlyRent * (cashReservesPercentage / 100);
            const totalMonthlyExpensesExcludingLoan = monthlyServiceCharge + monthlyHomeInsurance + utilitiesMonthly + cleaningMonthly + 
                                                      monthlyCapexReserve + monthlyRepairsMaintenance + monthlyPropertyManagementFee + 
                                                      monthlyVacancyLoss + monthlyRefinanceCostAllocation + monthlyCashReservesAllocation;

            // 4. Cash Flow
            const totalMonthlyOutflow = emi + totalMonthlyExpensesExcludingLoan;
            const monthlyNetCashFlow = grossMonthlyRent - totalMonthlyOutflow;
            const annualNetCashFlow = monthlyNetCashFlow * 12;

            // 5. Return Metrics
            const pricePerSqft = propertySize > 0 ? purchasePrice / propertySize : 0;
            const totalPricePerSqft = propertySize > 0 ? acquisitionCost / propertySize : 0;
            const roiWithoutExpenses = acquisitionCost > 0 ? (grossAnnualRent / acquisitionCost) * 100 : 0;
            const actualROI = acquisitionCost > 0 ? (annualNetCashFlow / acquisitionCost) * 100 : 0;
            const roiExcludingEMI = acquisitionCost > 0 ? ((grossAnnualRent - (totalMonthlyExpensesExcludingLoan * 12)) / acquisitionCost) * 100 : 0;

            // 6. Payback Period
            const netPaybackPeriod = annualNetCashFlow > 0 ? acquisitionCost / annualNetCashFlow : 'N/A';

            // Display Results
            const results = `
                <div class="section">
                    <h2>Loan & Initial Investment</h2>
                    <table class="result-table">
                        <tr><th>Metric</th><th>Value (AED)</th></tr>
                        <tr><td>Loan Amount</td><td>${loanAmount.toFixed(2)}</td></tr>
                        <tr><td>Down Payment</td><td>${downPayment.toFixed(2)}</td></tr>
                        <tr><td>Monthly EMI</td><td>${emi.toFixed(2)}</td></tr>
                        <tr><td>Gross Monthly Rent</td><td>${grossMonthlyRent.toFixed(2)}</td></tr>
                        <tr><td>Total Initial Cash Investment</td><td>${totalInitialCashInvestment.toFixed(2)}</td></tr>
                        <tr><td>Acquisition Cost</td><td>${acquisitionCost.toFixed(2)}</td></tr>
                    </table>
                </div>
                <div class="section">
                    <h2>Upfront Costs</h2>
                    <table class="result-table">
                        <tr><th>Metric</th><th>Value (AED)</th></tr>
                        <tr><td>DLD Fee Amount</td><td>${dldFeeAmount.toFixed(2)}</td></tr>
                        <tr><td>Mortgage Registration Amount</td><td>${mortgageRegistrationAmount.toFixed(2)}</td></tr>
                        <tr><td>Bank Processing Amount</td><td>${bankProcessingAmount.toFixed(2)}</td></tr>
                        <tr><td>Agency Fee Amount (inc. VAT)</td><td>${agencyFeeAmount.toFixed(2)}</td></tr>
                        <tr><td>Title Deed Fee</td><td>${titleDeedFee.toFixed(2)}</td></tr>
                        <tr><td>Registration Trustee Fee</td><td>${registrationTrusteeFee.toFixed(2)}</td></tr>
                        <tr><td>Property Valuation Fee</td><td>${propertyValuationFee.toFixed(2)}</td></tr>
                        <tr><td>Property Inspection Cost</td><td>${propertyInspectionCost.toFixed(2)}</td></tr>
                        <tr><td>Conveyance Fee</td><td>${conveyanceFee.toFixed(2)}</td></tr>
                        <tr><td>Furnishing Cost</td><td>${furnishingCost.toFixed(2)}</td></tr>
                        <tr><td>Total Non-Refundable Upfront Costs</td><td>${totalNonRefundableUpfrontCosts.toFixed(2)}</td></tr>
                    </table>
                </div>
                <div class="section">
                    <h2>Monthly Recurring Expenses</h2>
                    <table class="result-table">
                        <tr><th>Metric</th><th>Value (AED)</th></tr>
                        <tr><td>Monthly Service Charge</td><td>${monthlyServiceCharge.toFixed(2)}</td></tr>
                        <tr><td>Monthly Home Insurance</td><td>${monthlyHomeInsurance.toFixed(2)}</td></tr>
                        <tr><td>Monthly Utilities</td><td>${utilitiesMonthly.toFixed(2)}</td></tr>
                        <tr><td>Monthly Cleaning</td><td>${cleaningMonthly.toFixed(2)}</td></tr>
                        <tr><td>Monthly Capex Reserve</td><td>${monthlyCapexReserve.toFixed(2)}</td></tr>
                        <tr><td>Monthly Repairs/Maintenance</td><td>${monthlyRepairsMaintenance.toFixed(2)}</td></tr>
                        <tr><td>Monthly Property Management Fee</td><td>${monthlyPropertyManagementFee.toFixed(2)}</td></tr>
                        <tr><td>Monthly Vacancy Loss</td><td>${monthlyVacancyLoss.toFixed(2)}</td></tr>
                        <tr><td>Monthly Refinance Cost Allocation</td><td>${monthlyRefinanceCostAllocation.toFixed(2)}</td></tr>
                        <tr><td>Monthly Cash Reserves Allocation</td><td>${monthlyCashReservesAllocation.toFixed(2)}</td></tr>
                        <tr><td>Total Monthly Expenses (Excl. Loan)</td>< tả>${totalMonthlyExpensesExcludingLoan.toFixed(2)}</td></tr>
                    </table>
                </div>
                <div class="section">
                    <h2>Cash Flow</h2>
                    <table class="result-table">
                        <tr><th>Metric</th><th>Value (AED)</th></tr>
                        <tr><td>Total Monthly Outflow</td><td>${totalMonthlyOutflow.toFixed(2)}</td></tr>
                        <tr><td>Monthly Net Cash Flow</td><td>${monthlyNetCashFlow.toFixed(2)}</td></tr>
                        <tr><td>Annual Net Cash Flow</td>< biliyada>${annualNetCashFlow.toFixed(2)}</td></tr>
                    </table>
                </div>
                <div class="section">
                    <h2>Summary</h2>
                    <table class="result-table">
                        <tr><th>Metric</th><th>Value</th></tr>
                        <tr><td>Price per Sqft (AED)</td><td>${pricePerSqft.toFixed(2)}</td></tr>
                        <tr><td>Total Price per Sqft (AED)</td><td>${totalPricePerSqft.toFixed(2)}</td></tr>
                        <tr><td>ROI (Without Expenses) (%)</td><td>${roiWithoutExpenses.toFixed(2)}</td></tr>
                        <tr><td>Actual ROI (after expenses and EMI) (%)</td><td>${actualROI.toFixed(2)}</td></tr>
                        <tr><td>ROI (Excluding EMI) (%)</td><td>${roiExcludingEMI.toFixed(2)}</td></tr>
                        <tr><td>Net Payback Period</td><td>${typeof netPaybackPeriod === 'string' ? netPaybackPeriod : netPaybackPeriod.toFixed(2) + ' years'}</td></tr>
                    </table>
                </div>
            `;
            document.getElementById('results').innerHTML = results;
        }
    </script>
</body>
</html>